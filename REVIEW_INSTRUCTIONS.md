# ⚠️ REVIEW INSTRUCTIONS

> Generated by Gemini

```json
{
  "review": {
    "summary": "This PR introduces the Claude AI toolkit but simultaneously introduces multiple critical security vulnerabilities and severely degrades the existing Quality Assurance pipeline. Specifically, it exposes the workflow to script injection, disables security scanners, removes unit tests/type checks, and uses insecure temporary files in hooks. Additionally, downgrading all specialized agents to the 'Haiku' model significantly risks code quality and correctness.",
    "decision": "REQUEST_CHANGES"
  },
  "issues": [
    {
      "id": 1,
      "severity": "critical",
      "file": ".github/workflows/notify-on-failure.yml",
      "line": 1,
      "title": "Script Injection Vulnerability",
      "description": "The workflow replaces environment variable mapping with direct context interpolation (`${{ github.workflow }}`) inside the shell script. This allows an attacker to inject arbitrary shell commands via a crafted branch name or PR title (e.g., `branch'; env > leaked; #`).",
      "suggestion": "Revert to mapping GitHub context to environment variables (e.g., `env: WORKFLOW_NAME: ${{ github.workflow }}`) and use the environment variables in the shell command."
    },
    {
      "id": 2,
      "severity": "critical",
      "file": ".github/workflows/security.yml",
      "line": 1,
      "title": "Security Scanners Disabled",
      "description": "The `bandit` and `shellcheck` steps have been modified to append `|| true`. This suppresses exit codes, meaning the CI will pass even if critical security vulnerabilities are detected, rendering the security scan useless.",
      "suggestion": "Remove `|| true` from the security scanning commands to ensure the pipeline fails when vulnerabilities are found."
    },
    {
      "id": 3,
      "severity": "critical",
      "file": ".github/workflows/ci.yml",
      "line": 1,
      "title": "CI Pipeline Gutted (Tests Removed)",
      "description": "The `test` (pytest) and `typecheck` (mypy) jobs have been completely removed, and linting is now restricted to hooks only. This leaves the main application code without any automated verification.",
      "suggestion": "Restore the `test`, `typecheck`, and full `lint` jobs to ensure code correctness and quality."
    },
    {
      "id": 4,
      "severity": "important",
      "file": ".claude/hooks/post-tool-use.sh",
      "line": 1,
      "title": "Insecure Temporary File Usage (Symlink Attack)",
      "description": "The script uses hardcoded paths in the shared `/tmp` directory (e.g., `/tmp/claude_last_run`) instead of securely created random directories. This allows local attackers to perform symlink attacks to overwrite arbitrary files owned by the user running the script.",
      "suggestion": "Use `mktemp` to create a randomized, secure temporary file or directory for each run."
    },
    {
      "id": 5,
      "severity": "important",
      "file": ".claude/agents/code-reviewer.md",
      "line": 1,
      "title": "Agent Capability Downgrade",
      "description": "Critical agents (Code Reviewer, Infrastructure Engineer, Security Reviewer) have been downgraded from 'Opus' (high reasoning) to 'Haiku' (low reasoning). This creates a high risk of incorrect analysis, missed vulnerabilities, and flawed architectural advice.",
      "suggestion": "Revert the model configuration for complex agents (Reviewer, Security, Architect) to `sonnet` or `opus`."
    },
    {
      "id": 6,
      "severity": "important",
      "file": ".claude/hooks/auto-approve.sh",
      "line": 1,
      "title": "Unsafe Command Execution",
      "description": "The `find` command is now auto-approved without checking for dangerous flags (like `-exec`), and build/test commands are unrestricted. This allows an AI agent (or hijacked context) to execute arbitrary code via build scripts.",
      "suggestion": "Restore the blacklist for dangerous flags in `find` and require human approval for commands that execute arbitrary code (make, npm scripts)."
    },
    {
      "id": 7,
      "severity": "important",
      "file": ".github/mcp-config.json.template",
      "line": 1,
      "title": "SSRF Risk via Fetch Tool",
      "description": "The configuration enables the `fetch` MCP tool. In CI environments, this can allow access to internal network resources or cloud instance metadata (e.g., AWS IMDS), leading to credential theft.",
      "suggestion": "Disable the `fetch` tool in the CI configuration or ensure strict network egress filtering is in place."
    }
  ]
}
```